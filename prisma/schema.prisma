generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id_user      Int      @id @default(autoincrement())
  nama_lengkap String   @db.VarChar(50)
  username     String   @unique @db.VarChar(50)
  password     String   @db.VarChar(100)
  role         Role     @default(PETUGAS)
  status_aktif Boolean  @default(true)
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt

  kendaraan    Kendaraan[]
  transaksi    Transaksi[]
  logAktivitas LogAktivitas[]
}

model AreaParkir {
  id_area    Int      @id @default(autoincrement())
  nama_area  String   @db.VarChar(50) @unique 
  kapasitas  Int      @default(0)
  terisi     Int      @default(0)
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  transaksi   Transaksi[]
  alerts      Alert[]
  slots       SlotParkir[]
}

model Kendaraan {
  id_kendaraan    Int            @id @default(autoincrement())
  plat_nomor      String         @unique @db.VarChar(15)
  jenis_kendaraan JenisKendaraan
  warna           String         @db.VarChar(20)
  pemilik         String         @db.VarChar(100)
  id_user         Int
  created_at      DateTime       @default(now())
  updated_at      DateTime       @updatedAt

  user      User        @relation(fields: [id_user], references: [id_user])
  transaksi Transaksi[]
}

model Tarif {
  id_tarif        Int            @id @default(autoincrement())
  jenis_kendaraan JenisKendaraan @unique
  tarif_per_jam   Decimal        @db.Decimal(10, 0)
  created_at      DateTime       @default(now())
  updated_at      DateTime       @updatedAt

  transaksi Transaksi[]
}

model Transaksi {
  id_parkir    Int             @id @default(autoincrement())
  id_kendaraan Int
  waktu_masuk  DateTime
  waktu_keluar DateTime?
  id_tarif     Int
  durasi_jam   Int?            @default(0)
  biaya_total  Decimal?        @db.Decimal(10, 0)
  status       StatusTransaksi @default(MASUK)
  id_user      Int
  id_area      Int
  created_at   DateTime        @default(now())
  updated_at   DateTime        @updatedAt

  kendaraan  Kendaraan  @relation(fields: [id_kendaraan], references: [id_kendaraan])
  tarif      Tarif      @relation(fields: [id_tarif], references: [id_tarif])
  user       User       @relation(fields: [id_user], references: [id_user])
  areaParkir AreaParkir @relation(fields: [id_area], references: [id_area])

  @@index([waktu_masuk])
  @@index([status])
}

model LogAktivitas {
  id_log          Int      @id @default(autoincrement())
  id_user         Int
  aktivitas       String   @db.VarChar(100)
  waktu_aktivitas DateTime @default(now())

  user User @relation(fields: [id_user], references: [id_user])
}

model Alert {
  id_alert      Int        @id @default(autoincrement())
  id_area       Int
  tipe_alert    TipeAlert
  pesan         String     @db.VarChar(255)
  severity      Severity   @default(WARNING)
  is_read       Boolean    @default(false)
  created_at    DateTime   @default(now())
  updated_at    DateTime   @updatedAt

  areaParkir AreaParkir @relation(fields: [id_area], references: [id_area])

  @@index([id_area])
  @@index([is_read])
}

model SlotParkir {
  id_slot      Int      @id @default(autoincrement())
  id_area      Int
  nomor_slot   String   @db.VarChar(10)
  status       StatusSlot @default(TERSEDIA)
  reserved     Boolean  @default(false)
  id_transaksi Int?
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt

  areaParkir AreaParkir @relation(fields: [id_area], references: [id_area])

  @@unique([id_area, nomor_slot])
  @@index([id_area])
  @@index([status])
}

enum TipeAlert {
  AREA_FULL
  AREA_ALMOST_FULL
  SLOT_AVAILABLE
  SYSTEM_WARNING
  KENDARAAN_RUSAK
}

enum Severity {
  INFO
  WARNING
  CRITICAL
}

enum StatusSlot {
  TERSEDIA
  TERISI
  MAINTENANCE
}

enum Role {
  ADMIN
  PETUGAS
  OWNER
}

enum JenisKendaraan {
  MOTOR
  MOBIL
  LAINNYA
}

enum StatusTransaksi {
  MASUK
  KELUAR
}